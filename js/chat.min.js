document.addEventListener("DOMContentLoaded", function() {
    var chatContainer = document.getElementById("chatContainer");
    var chatInput = document.getElementById("chatInput");
    var chatSendButton = document.getElementById("chatSendButton");
    
    function addMessageToChat(role, content) {
        var messageDiv = document.createElement("div");
        messageDiv.className = role;
        messageDiv.textContent = content;
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    chatSendButton.addEventListener("click", function() {
        var userMessage = chatInput.value;
        addMessageToChat("user", userMessage);
        chatInput.value = "";

        // Use EventSource to handle Server-Sent Events
        var source = new EventSource("/cloudchat/chat", {
            method: 'POST',
            body: JSON.stringify({
                "message": userMessage
            }),
            headers: {
                "Content-Type": "application/json"
            }
        });

        source.onmessage = function(event) {
            var data = JSON.parse(event.data);
            addMessageToChat("ai", data.message);
        };

        source.onerror = function(error) {
            console.error("EventSource failed:", error);
            source.close();
        };
    });
});
