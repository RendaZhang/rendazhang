document.addEventListener("DOMContentLoaded", function() {
    let chatInput = document.getElementById("chat-input");
    let chatSendButton = document.getElementById("send-btn");
    let chatMessages = document.getElementById("chat-messages");
    
    function addMessage(role, content) {
        let messageDiv = document.createElement("div");
        messageDiv.classList.add("message", role);
        messageDiv.innerHTML = content;
        chatMessages.appendChild(messageDiv);
    }

    chatSendButton.addEventListener("click", function() {
        let userMessage = chatInput.value.trim();
        if (userMessage) {
            addMessage("user", userMessage);
            chatInput.value = "";

            // Call the backend API to get the response from the AI model
            fetch("/cloudchat/chat", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    message: userMessage
                })
            }).then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error("Failed to fetch response from server");
            }).then(data => {
                // Process each message in the array
                for (let msg of data.messages) {
                    addMessage("assistant", msg.content);
                }
            }).catch(error => {
                console.error("Error:", error);
                addMessage("assistant", "Sorry, there was an error processing your request.");
            });
        }
    });

    chatInput.addEventListener("keydown", function(event) {
        if (event.key === "Enter" && !event.shiftKey) {
            event.preventDefault();
            chatSendButton.click();
        }
    });
});
