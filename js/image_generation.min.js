document.getElementById('image-form').addEventListener('submit', function (e) {
    e.preventDefault();
    
    const prompt = document.getElementById('prompt').value;
    const loading = document.getElementById('loading');
    const imageContainer = document.getElementById('image-container');
    
    loading.style.display = 'block';
    imageContainer.innerHTML = '';
    
    fetch('/cloudchat/generate_image', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ prompt: prompt })
    })
    .then(response => response.json())
    .then(data => {
        if (data.image_urls) {
            data.image_urls.forEach(url => {
                const img = document.createElement('img');
                img.src = url;
                img.alt = 'Generated Image';
                img.onload = function() {
                    loading.style.display = 'none';
                };
                imageContainer.appendChild(img);
            });
        } else {
            loading.style.display = 'none';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        loading.style.display = 'none';
    });
});
