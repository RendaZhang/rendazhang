document.addEventListener('DOMContentLoaded', function() {
    // 第一步：优先加载和渲染 Markdown 内容
    $.get('README.md', function(data) {
        // 将 Markdown 转换为 HTML 并插入 DOM
        const html = marked.parse(data);
        document.getElementById('content').innerHTML = html;
        
        // 第二步：内容渲染完成后，异步加载美化脚本
        const loadScript = (src, callback) => {
            const script = document.createElement('script');
            script.src = src;
            script.onload = callback;
            document.head.appendChild(script);
        };

        // 并行加载高亮和Mermaid
        Promise.all([
            new Promise(resolve => loadScript('/js/highlight.min.js', resolve)),
            new Promise(resolve => loadScript('/js/mermaid.min.js', resolve))
        ]).then(() => {
            // 第三步：所有脚本加载完成后执行美化
            hljs.highlightAll();
            mermaid.initialize({ startOnLoad: false });
            mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
            console.log('All enhancements applied');
        });
    }).fail(function() {
        document.getElementById('content').innerHTML = '<p>Error loading documentation</p>';
    });
});