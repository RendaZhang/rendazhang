<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-Time Speech Recognition</title>
</head>
<body>
    <button id="start-recording">Start Recording</button>
    <button id="stop-recording" disabled>Stop Recording</button>
    <div id="transcription-container"></div>
    
    <script>
        document.getElementById('start-recording').addEventListener('click', function () {
            // Request permission and start recording
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    const mediaRecorder = new MediaRecorder(stream);
                    const audioChunks = [];
                    
                    mediaRecorder.addEventListener("dataavailable", event => {
                        audioChunks.push(event.data);
                    });
                    
                    mediaRecorder.addEventListener("stop", () => {
                        // Send audio data to the server
                        const audioBlob = new Blob(audioChunks);
                        const formData = new FormData();
                        formData.append("audio_data", audioBlob);
                        
                        fetch('/cloudchat/transcribe_audio', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => response.json())
                        .then(data => {
                            // Display the transcription result
                            document.getElementById('transcription-container').textContent = data.transcription;
                        })
                        .catch(error => console.error('Error:', error));
                    });
                    
                    document.getElementById('stop-recording').disabled = false;
                    mediaRecorder.start();
                    
                    document.getElementById('stop-recording').addEventListener('click', function () {
                        mediaRecorder.stop();
                        document.getElementById('stop-recording').disabled = true;
                    });
                })
                .catch(error => console.error('Error:', error));
        });
    </script>
</body>
</html>
