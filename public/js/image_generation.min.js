document.getElementById('image-form').addEventListener('submit', function (e) {
    e.preventDefault();
    const API_BASE_URL = (window.config && window.config.API_BASE_URL) || '/cloudchat';
    const ENDPOINT_IMAGE = (window.config && window.config.ENDPOINTS && window.config.ENDPOINTS.IMAGE_GENERATION) || `${API_BASE_URL}/generate_image`;
    
    const prompt = document.getElementById('prompt').value;
    const loading = document.getElementById('loading');
    const imageContainer = document.getElementById('image-container');
    
    loading.style.display = 'block';
    imageContainer.innerHTML = '';
    
    fetch(ENDPOINT_IMAGE, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ prompt: prompt })
    })
    .then(response => response.json())
    .then(data => {
        if (data.image_urls) {
            data.image_urls.forEach(url => {
                const img = document.createElement('img');
                img.src = url;
                img.alt = 'Generated Image';
                img.onload = function() {
                    loading.style.display = 'none';
                };
                imageContainer.appendChild(img);
            });
        } else {
            loading.style.display = 'none';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        loading.style.display = 'none';
    });
});
